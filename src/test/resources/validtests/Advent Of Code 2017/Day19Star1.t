import java::lang::Math
import java::lang::StringBuilder
import T::std::Vector

val input = `
                                                                                                                                                         |
                                                 +-------------------------------------------------------------------------------------------------------------------------------------------+
                                                 |                                                                                                       |                                   |
 +---------+                                     |         +---------------+         +-------------+           +---+   +-----------------------------------------------------------------+   |
 |         |                                     |         |               |         |             |           |   |   |                                 |                               |   |
 |         |         +---------------+       +---|-------------------------|---------|---+         |           +-----------------------------------------|-------------------------------|-------------+
 |         |         |               |       |   |         |               |         |   |         |               |   |                                 |                               |   |         |
 +-------------------------------------------|---|-------------------------|-------------|-------------------------|---|---------------------------+     |             +---+ +-------------------+ +-+ |
           |         |               |       |   |         |               |         |   |         |               |   |                           |     |             |   | |           |   |   | | | |
 +---------|---------+               |       +-----------------------------|---------|---|---------|---------------|------D--------------------------------------------------|-------------------+ | | |
 |         |                         |           |         |               |         |   |         |               |   |                           |     |             |   | |           |   |     | | |
 |   +-------------------------------------------|-------+ |               |         |   |       +-|-----+     +---------------------------------+ | +---|-------------|-------------------+ |     | | |
 |   |     |                         |           |       | |               |         |   |       | |     |     |   |   |                         | | |   |             |   | |           | | |     | | |
 |   |     |                       +---------+   |       | |               |         |   |       | |     |     |   |   |           +-------------|---|---|-------------+   | |           | | |     | | |
 |   |     |                       | |       |   |       | |               |         |   |       | |     |     |   |   |           |             | | |   |                 | |           | | |     | | |
 | +-------------------+           | | +-----------------|-|-------------------------|---|-------------+ | +-+ +---|-----------------+   +-------|----R--|-----------------------+ +-+   | | +-+   | | |
 | | |     |           |           | | |     |   |       | |               |         |   |       | |   | | | |     |   |           | |   |       | | |   |                 | |   | | |   | |   |   | | |
 | | |     |           |           | | |     |   |       | |     +-+ +-------------------|---------|---|-----------|---------------|-|---|---------|-|---|-------------+   | |   | | |   | |   |   | | |
 | | |     |           |           | | |     |   |       | |     | | |     |         |   |       | |   | | | |     |   |           | |   |       | | |   |             |   | |   | | |   | |   |   | | |
 | | |     |         +-|-------------------------|---------|---------|---------+     |   |       | |   | | | |     |   |           +-----|-------+ | |   |             |   | |   | +-|---|-+   |   | | |
 | | |     |         | |           | | |     |   |       | |     | | |     |   |     |   |       | |   | | | |     |   |             |   |         | |   |             |   | |   |   |   |     |   | | |
 | | |     |         | |           | +-----------|---------+     | | |     | +-|-----|---|-------|-----|-----|-----------------------|---+     +---------|-------------|-------------|---|-------------+
 | | |     |         | |           |   |     |   |       |       | | |     | | |     |   |       | |   | | | |     |   |             |         |   | |   |             |   | |   |   |   |     |   | |
 | +-|-----------------------------|---------|---|-------|-----------------|-|-|-----|-----------|---------------------------------------------+   | |   |             |   | |   |   |   |     |   | |
 |   |     |         | |           |   |     |   |       |       | | |     | | |     |   |       | |   | | | |     |   |             |             | |   |             |   | |   |   |   |     |   | |
 |   |     |         | |     +-+   |   |     |   |       |       | | |     | | |     |   |       | |   | | | |     |   |             |       +-----|-|---|-------+     |   | |   +-------|-------+ | |
 |   |     |         | |     | |   |   |     |   |       |       | | |     | | |     |   |       | |   | | | |     |   |             |       |     | |   |       |     |   | |       |   |     | | | |
 |   |     |         | |     | +-------|-----|-----------|-----------|---+ | | |     |   |       | |   | | | +-----|---|-+ +---------|-------|-------|---|-------|-----|---+ |       |   |     | | | |
 |   |     |         | |     |     |   |     |   |       |       | | |   | | | |     |   |       | |   | | |       |   | | |         |       |     | |   |       |     |     |       |   |     | | | |
 | +-------------------|-----|---------|-----|---|---------------|-|-------|-|-------|-----------+ | +---|-|---+   |   | +---+       |       +-----------|-------|-----------|-------|---------|-+ | |
 | | |     |         | |     |     |   |     |   |       |       | | |   | | | |     |   |         | | | | |   |   |   |   | |       |             | |   |       |     |     |       |   |     |   | |
 | | |     |         | |     |     |   | +-------|-------------------------|---|---------+         | | | | |   |   |   |   | |       |       +-----|-|-----------+   +---------------+   |     |   | |
 | | |     |         | |     |     |   | |   |   |       |       | | |   | | | |     |             | | | | |   |   |   |   | |       |       |     | |   |           | |     |           |     |   | |
 | | |     |         | |     |     |   | |   |   |       |       | | |   | | | |     |             | | | | |   |   |   +---|-|-------|-------|-----|-----|-------+   | |     |           | +---|---|-|-+
 | | |     |         | |     |     |   | |   |   |       |       | | |   | | | |     |             | | | | |   |   |       | |       |       |     | |   |       |   | |     |           | |   |   | | |
 | | |     |         | |     |     |   | |   |   |       |       | | |   | | | |     |             | | | | |   | +---------|-|---------------|-----|-----|---+   |   | |     |           | |   |   | | |
 | | |     |         S |     |     |   | |   |   |       |       | | |   | | | |     |             | | | | |   | | |       | |       |       |     | |   |   |   |   | |     |           | |   |   | | |
 | | |     |   +-------|-----|--------F|-|---|---|---------------------+ | | | |     |             | | | | |   | | |       | +-----------+   +-+ +-|-|---|---|-------|-----------------+ | |   |   | | |
 | | |     |   |     | |     |     |   | |   |   |       |       | | | | | | | |     |             | | | | |   | | |       |         |   |     | | | |   |   |   |   | |     |         | | |   |   | | |
 | | |     |   |     | |     |     |   | |   |   |       |       | | | | | | +-|-----+         +---|-----------+ | |     +---------------|---------------|---|-----+ +-|---------+     | | |   |   | | |
 | | |     |   |     | |     |     |   | |   |   |       |       | | | | | |   |               |   | | | | |     | |     | |         |   |     | | | |   |   |   | |   |     |   |     | | |   |   | | |
 | | |     | +---+   | +-----|-----|---------------------|-------|-|---|-----------------------|-------|-|-------|-------|-----------|---|---------|-----|-------|-|-+ |     |   |     | | |   |   | | |
 | | |     | | | |   |       |     |   | |   |   |       |       | | | | | |   |               |   | | | | |     | |     | |         |   |     | | | |   |   |   | | | |     |   |     | | |   |   | | |
 +-|---+   | | | +---------------------------|-------------------------|-|---------------------|---------|---------------|-----------|-------+ | | | |   |   |   | | | |     |   |     | | |   |   | | |
   | | |   | | |     |       |     |   | |   |   |       |       | | | | | |   |               |   | | | | |     | |     | |         |   |   | | | | |   |   |   | | | |     |   |     | | |   |   | | |
   | | |   | | |     |       |     |   | |   |   |       |   +---|---|-|-|-----|-------------------|---|---|-------------|-----------------------|-|-|-+ |   |   | | | |     |   |     | | |   |   | | |
   | | |   | | |     |       |     |   | |   |   |       |   |   | | | | | |   |               |   | | | | |     | |     | |         |   |   | | | | | | |   |   | | | |     |   |     | | |   |   | | |
   | | |   | | |     |       |     |   | |   |   |       +---|---|-|---|-|---+ |               |   | | | | +-----|-|-----|---+ +-----|---+   | | | | | | |   |   | | | |     |   |   +-|-|-+   |   | | |
   | | |   | | |     |       |     |   | |   |   |           |   | | | | | | | |               |   | | | |       | |     | | | |     |       | | | | | | |   |   | | | |     |   |   | | |     |   | | |
   | | |   | | |     |       |     |   | |   |   |           |   | | | +-|-|-|-|-------------------|-|-------------|---+ | | | |     |       | | | | | | |   |   | | | |     |   |   | | | +---|-+ | | |
   | | |   | | |     |       |     |   | |   |   |           |   | | |   | | | |               |   | | | |       | |   | | | | |     |       | | | | | | |   |   | | | |     |   |   | | | |   | | | | |
   | | +-----|-+     |   +---------|-----|---|---------------|-----|---------|-----------------|---|-|-|-----------|-------|---|-----|-------|-|-|---|-|---------|-|---|---------|---|-----+   | | | | |
   | |     | |       |   |   |     |   | |   |   |           |   | | |   | | | |               |   | | | |       | |   | | | | |     |       | | | | | | |   |   | | | |     |   |   | | |     | | | | |
 +---|---+ | |       |   |   |     |   | |   +---------+     |   | | |   | | | |             +-|---|---|---------|-------|-|-|-|-----|-------------|---|-----|-----|---|-------------|-+ |     | | | | |
 | | |   | | |       |   |   |     |   | |       |     |     |   | | |   | | | |             | |   | | | |       | |   | | | | |     |       | | | | | | |   |   | | | |     |   |   |   |     | | | | |
 | | |   | | |       |   |   |     |   | |       |     |     |   | | |   | | | |             | |   | | | |       | | +-----|---+     |       | | +-|-|---|---|---|-----|-----|---|-------|---+ | | | | |
 | | |   | | |       |   |   |     |   | |       |     |     |   | | |   | | | |             | |   | | | |       | | | | | | |       |       | |   | | | |   |   | | | |     |   |   |   |   | | | | | |
 | | |   | +-|-------|---|-+ |     |   | |       |     |     |   | | |   | | | |             | |   | | | |   +-----|-|-|---|-|-------|-------|-----|-|-+ |   |   | | | |     |   |   |   |   | | | | | |
 | | |   |   |       |   | | |     |   | |       |     |     |   | | |   | | | |             | |   | | | |   |   | | | | | | |       |       | |   | |   |   |   | | | |     |   |   |   |   | | | | | |
 | | | +-------+ +---|---|-|-----------|-|-------|-----|-----|---|-|-----|-----|-------------|-----|-----------------|---+ | |       |       | +---|-+ +-----|-------|-----------|---+   |   | | | | | |
 | | | | |   | | |   |   | | |     |   | |       |     |     |   | | |   | | | |             | |   | | | |   |   | | | |   | |       |       |     |   | |   |   | | | |     |   |       |   | | | | | |
 | | | | |   | | |   |   | | |     |   | |       |     |     | +-|-+ |   | | | |             | |   | | | |   |   | | | |   | |       |       |     |   | |   |   | | +-------|-+ |       |   | | | | | |
 | | | | |   | | |   |   | | |     |   | |       |     |     | | |   |   | | | |             | |   | | | |   |   | | | |   | |       |       |     |   | |   |   | |   |     | | |       |   | | | | | |
 | | | +-|-----|-------------|---------|---------|-----------|-----------------|-------------|-|---|-------+ |   | | | |   | |       |   +-------+ |   | |   |   | |   +-----|-|-|-----------|---|-|---+
 | | |   |   | | |   |   | | |     |   | |       |     |     | | |   |   | | | |             | |   | | | | | |   | | | |   | |       |   |   |   | |   | |   |   | |         | | |       |   | | | | |
 | | |   |   | | |   |   | | |     |   | |       |     |     | | |   |   +-|-|-|---------------------|-----|-|-----|-|-------------------|---|-+ | |   | |   |   | |         | | |       |   | | | | |
 | | |   |   | | |   |   | | |     |   | |       |     |     | | |   |     | | |             | |   | | | | | |   | | | |   | |       |   |   | | | |   | |   |   | |         | | |       |   | | | | |
 | | |   +---|-|-|---------------+ | +-+ |       |     |     | | |   |     | | |             | |   | | | | | |   | | | |   | |       |   | +-+ | +-------|-------------------|---|-------|---------+ |
 | | |       | | |   |   | | |   | | |   |       |     |     | | |   |     | | |             | |   | | | | | |   | | | |   | |       |   | |   |   |   | |   |   | |         | | |       |   | | |   |
 | | |       | | |   |   | | |   | | |   |       |     |     | | |   |     | | |             | |   | | | | | |   | | | |   | |       |   | |   |   |   | |   |   | |         | | |       |   | | |   |
 | | |       | | |   |   | | |   | | |   |       |     |     | | |   |     | | |             | |   | | | | | |   | | | |   | |       |   | |   |   |   | |   |   | |         | | |       |   | | |   |
 | | |     +-----|---|-----|-|---|-|-----|---------+   |     | | |   |     | | |         +-----|-------+ | +-----|---|-------|-------|-----|-----------------|---|-|---------|-|-|-+     |   | | |   |
 | | |     | | | |   |   | | |   | | |   |       | |   |     | | |   |     | | |         |   | |   | |   |   |   | | | |   | |       |   | |   |   |   | |   |   | |         | | | |     |   | | |   |
 | | |     | | | |   |   | | |   | | |   |       | |   +---------------------|-----------------|-----------------|-|-|-|---|-|-------------|-----------------|-----+         | | | |     |   | | |   |
 | | |     | | | |   |   | | |   | | |   |       | |         | | |   |     | | |         |   | |   | |   |   |   | | | |   | |       |   | |   |   |   | |   |   |           | | | |     |   | | |   |
 | | |     | | | |   |   | | |   | | |   |       | |         | | |   |     | | |         |   | |   | |   |   |   | | | |   | |       |   | |   |   |   | |   |   |           | | | |     |   +-------|-+
 | | |     | | | |   |   | | |   | | |   |       | |         | | |   |     | | |         |   | |   | |   |   |   | | | |   | |       |   | |   |   |   | |   |   |           | | | |     |     | |   | |
 | | | +---|-----|---|-----------|-|-|-------------|-----+   +---|-+ |     | | |         |   | |   | |   |   |   | +---------|-----+ |   | |   |   |   | |   |   |           | | | |     |     | |   | |
 | | | |   | | | |   |   | | |   | | |   |       | |     |     | | | |     | | |         |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |   |   |           | | | |     |     | |   | |
 | | | | +-+ +---|---------+ |   | | +---|-------|-|-----|---------|-|-----|-------------------|---|-|---|---------------------------|---|-|-------------|-------|-----------+ | | |   +---------+ +---+
 | | | | |     | |   |   |   |   | |     |       | |     |     | | | |     | | |         |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |   |   |             | | |   | |     |   | |
 | | | | +-+   | |   |   +---|-----|-----+       | |     +-------|-|-|-----|-|-|-------+ |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |   |   |             +-|-|---|-------------|-+
 | | | |   |   | |   |       |   X |             | |           | | | |     | | |       | |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |   |   |               | |   | |     |   | | |
 | | | +---|-+ | |   |       |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |   +---|-----------------+   | |     |   | | |
 | | |     | | | |   |       |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |       |               |     | |     |   | | |
 | | |     | | | |   |   +-------|---------------|-|-------------|-|---------|-----------|---|-----|-----|-----------+ |   | |     +-|-----|---+   |   | +-------|-------+ +-----|-----+ |     |   | | |
 | | |     | | | |   |   |   |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |     |   | |       |   | |       |   |         |       | |     |       |     |   | | |
 | | |   +---|---|-----------|---|-|-------------|---------------|-|---------------------|-----|---|-----|---|---|-----|-----------+ |   | |       |   |         |     +-|---------------------|-+ | | |
 | | |   | | | | |   |   |   |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |     |   | |     | |   | |       |   |         |     | | |     |       |     | | | | |
 +-|-|-----|---+ |   |   |   |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |     |   | |     | |   | |       |   |         |     | | |     |       |     | | | | |
   | |   | | |   |   |   |   |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |     |   | |     | |   | |       |   |         |     | | |     |       |     | | | | |
   | |   | | |   |   |   |   |   | | +-------------|-----------------|---------|-------|-----|-----|-|---|---|---+     |   | |     +-----|---------|-------------|-----|---|-----|-------|-----|-+ | | |
   | |   | | |   |   |   |   |   | | |           | |           | | | |     | | |       | |   | |   | |   |   |         |   | |       |   | |       |   |         |     | | |     |       |     |   | | |
 +-|-|---|-|-|-------|-----------|---|---+       | |           | | +---------|---------|-|---------------|-------------|---|-+       |   | |       | +-|---------|-------|-------------+ |     |   | | |
 | | |   | | |   |   |   |   |   | | |   |       | |           | |   |     | | |       | |   N |   | |   |   |         |   |         |   | |       | | |         |     | | |     |     | |     |   | | |
 | | |   +-|-|-----------|---|---|-|---------------|-------------|-----+   | | |       | |   | |   | |   |   |         |   |       +-------------+ | | |         |     | | |     | +---|-|-----+   | | |
 | | |     | |   |   |   |   |   | | |   |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       | |   | |     | | | |         |     | | |     | |   | |         | | |
 | | +-+   | |   +---|-------|-----|-+   |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       | +-------------|---|---------|-----|---------|-----|-----------+ | |
 | |   |   | |       |   |   |   | |     |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | | |         |     | | |     | |   | |           | |
 | |   |   | |       |   |   |   | |     |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | | |         |     | | |     | |   | |           | |
 | |   |   | |       |   |   |   | |     |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | | |         |     | | |     | |   | |           | |
 | |   |   | |       |   |   | +---|---------------|-----------------|-|-------|-------|-----------|-|---|---|---------------------------|-------|-----+         |     | | |     | |   | |   +-----+ | |
 | |   |   | |       |   |   | | | |     |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | |           |     | | |     | |   | |   |     | | |
 | |   |   | | +-------------|-------------------|-|---+       | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | |           |     | | |     | |   | |   |     | | |
 | |   |   | | |     |   |   | | | |     |       | |   |       | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | |           |     | | |     | |   | |   |     | | |
 | |   |   | | |     |   |   | | | | +-+ |       | |   | +-------|-----|---|-|----------------P----|-----|---|---------|---|-------------|-|---------|-----------|-----|-|-|-+   | |   | |   |     | | |
 | |   |   | | |     |   |   | | | | | | |       | |   | |     | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | |           |     | | | |   | |   | |   |     | | |
 | |   |   | | |     |   |   | | | | | +---------|-------|-----|-----|---------|---------------|---------|-------------|-----------|-----|-|-------|---------+   |     | | | |   | |   | |   |     | | |
 | |   |   | | |     |   |   | | | | |   |       | |   | |     | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | |       |   |     | | | |   | |   | |   |     | | |
 | |   |   | | |     |   |   | | | | | +-|---------------|-----|-------|---|-----------|-------|-----|-------|---------+   |       |     | |     | | |       |   |     | | | |   | |   | |   |     | | |
 | |   |   | | |     |   |   | | | | | | |       | |   | |     | |   | |   | | |       | |   | |   | |   |   |             |       |     | |     | | |       |   |     | | | |   | |   | |   |     | | |
 | |   |   | | |     +-------------|-------------|-------|-----|-----------|-|-|-------|---------------------|-------------|-----------------------|---------|---+     | | +-------|---|-----+   +-+ | |
 | |   |   | | |         |   | | | | | | |       | |   | |     | |   | |   | | |       | |   | |   | |   |   |             |       |     | |     | | |       |         | |   |   | |   | |       |   | |
 | |   |   | | |       +-------|-|-|-|-|-------+ | |   | |     | |   | |   | | |       | |   | |   | |   |   |             |       | +-----|-----|-----------------+   | |   |   +-|-+ | |       | +---+
 | |   |   | | |       | |   | | | | | | |     | | |   | |     | |   | |   | | |       | |   | |   | |   |   |             |       | |   | |     | | |       |     |   | |   |     | | | |       | | |
 | |   |   | | |       | |   | | | | | | |     | | |   | |     | |   | |   +---|-----+ | |   | |   | |   |   |             |       | |   | |     | | |   +---|---------|-|---+     | | | |       | | +-+
 | |   |   | | |       | |   | | | | | | |     | | |   | |     | |   | |     | |     | | |   | |   | |   |   |             |       | |   | |     | | |   |   |     |   | |         | | | |       | |   |
 | |   |   | | |       | |   | | | | | | |     | | |   | |     | |   | |     | |     | | |   +-|-+ +---------|---------+   |       | |   | | +-------|-------------|---|-|---------|-------------+ |   |
 | |   |   | | |       | |   | | | | | | |     | | |   | |     | |   | |     | |     | | |     | |   |   |   |         |   |       | |   | | |   | | |   |   |     |   | |         | | | |         |   |
 | | +-------|-|---------|---|-----|---|-|-----|-|-------|-----|-------|-------|-------|-|-------|---------------------|---|---------|---|-|-----|-|-|---|---|-------+ | |         | | | |     +---+   |
 | | | |   | | |       | |   | | | | | | |     | | |   | |     | |   | |     | |     | | |     | |   |   |   |         |   |       | |   | | |   | | |   |   |     | | | |         | | | |     |       |
 | | | |   | | |       | |   | | | | | | |   +-+ | |   | |   +---------|-------------|---------|-----|---|-----------------+       | |   | | |   | | |   |   |     | +-|---+       | | | |     |       |
 | | | |   | | |       | |   | | | | | | |   |   | |   | |   | | |   | |     | |     | | |     | |   |   |   |         |           | |   | | |   | | |   |   |     |   | | |       | | | |     |       |
 | | | |   | | |       | |   | | | | | | |   |   | |   | |   | | |   | |     | |     | | |     | |   |   | +-|---------------------|---------|---|---|---|-------------|-----------|---|-|-----|---+   |
 | | | |   | | |       | |   | | | | | | |   |   | |   | |   | | |   | |     | |     | | |     | |   |   | | |         |           | |   | | |   | | |   |   |     |   | | |       | | | |     |   |   |
 | | | |   | | |       | |   | | | | | | |   |   | |   | |   | | |   | |     | |     | | |     | |   +-----|-|---------------------|-|---|-|-|-----|-----|---+     |   | | |       | | | |     |   |   |
 | | | |   | | |       | |   | | | | | | |   |   | |   | |   | | |   | |     | |     | | |     | |       | | |         |           | |   | | |   | | |   |         |   | | |       | | | |     |   |   |
 | | | |   | | |       | |   | | | | | | |   |   | +---------|-------|-------|-|---------------|-|---------|-|---------|-----------|-|-----------|---|-----+       |   | | |       | | | |     |   |   |
 | | | |   | | |       | |   | | | | | | |   |   |     | |   | | |   | |     | |     | | |     | |       | | |         |           | |   | | |   | | |   | |       |   | | |       | | | |     |   |   |
 | | | |   | | |       | +---|-|---|-----|---|-----------|---+ | |   | |     | |     | | |     | |       | | |         +-----------|-------|-----|-|-----------------------------------|-|-----|---|-+ |
 | | | |   | | |       |     | | | | | | |   |   |     | |     | |   | |     | |     | | |     | |       | | |                     | |   | | |   | | |   | |       |   | | |       | | | |     |   | | |
 | | | | +-----------------------|-----|-|---+   |     | |     | |   | |     | |     | | |     | |       | | +---------------------|-------|-|-----|-|---|---------|---|-----------|-|-|-----------|-+ |
 | | | | | | | |       |     | | | | | | |       |     | |     | |   | |     | |     | | |     | |       | |                       | |   | | |   | | |   | |       |   | | |       | | | |     |   |   |
 | | +---+ | | |       |     | | | | | +-----------------|-----|-----|---------------|---------------------------------------------|-----|---------|-|-------------------|---------|-----|-----|-----+ |
 | |   |   | | |       |     | | | | |   |       |     | |     | |   | |     | |     | | |     | |       | |                       | |   | | |   | | |   | |       |   | | |       | | | |     |   | | |
 | |   |   | | |       |     | | | | |   |       |     | | +-+ +-----|-------|---------|-----+ | |       | |                       | |   | | |   | | |   | |       | +-|-|-------+ | | | |     |   | | |
 | |   |   | | |       |     | | | | |   |       |     | | | |   |   | |     | |     | | |   | | |       | |                       | |   | | |   | | |   | |       | | | | |     | | | | |     |   | | |
 +-|-----------|-------|-----+ +---+ |   |   +-------------|---------|-------|-------|-|--------------J--|-+                       +-+   | | |   | | |   | |       | | | | |     | | | | |     |   | | |
   |   |   | | |       |         |   |   |   |   |     | | | |   |   | |     | |     | | |   | | |       |                               | | |   | | |   | |       | | | | |     | | | | |     |   | | |
   |   |   | | |       |         |   |   |   |   |     | | | |   |   | |     | |     | | |   +-+ |       |                               | | |   | | |   | |       | | | | |     | | | | |     |   | | |
   |   |   | | |       |         |   |   |   |   |     | | | |   |   | |     | |     | | |       |       |                               | | |   | | |   | |       | | | | |     | | | | |     |   | | |
   |   |   | | |       |         |   |   |   |   |     | | | |   |   | |     | |     +-|---------|---------------------------------------|-|---------|---|-|-------|-+ | | |     | | | | |     |   | | |
   |   |   | | |       |         |   |   |   |   |     | | | |   |   | |     | |       | |       |       |                               | | |   | | |   | |       |   | | |     | | | | |     |   | | |
 +-|-+ |   | | |     +-|---------|-+ |   +-----------------|-|---|---|-|-----|-|-------|-|---------------|---+                           | +-+   | | |   | |       |   | | |   +-|-------|-----|---+ | |
 | | | |   | | |     | |         | | |       |   |     | | | |   |   | |     | |       | |       |       |   |                           |       | | |   | |       |   | | |   | | | | | |     |     | |
 | | | | +-|-|-------------------|-|---------------------+ | |   |   +---------|-----------------------------|---------------------------|---------|-|---+ |       |   | | |   | | | +-|-------|-+   | |
 | | | | | | | |     | |         | | |       |   |     |   | |   |     |     | |       | |       |       |   |                           |       | | |     |       |   | | |   | | |   | |     | |   | |
 | +-|---+ | | |     | |         | | |       |   |     |   | |   |     |     | |       | |       |       | +-|---------------------------|---------|-|-------------|-----|-------|-|---|---------|-+ | |
 |   | |   | | |     | |         | | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |       |   | | |   | | |   | |     | | | | |
 |   | |   | | |     | +---------|-|-|---------------------------------|-----|-|-------|---------|---------|-|---------------------------|---------|-------------+ |   | | +-------|---|-------|-|-+ | |
 |   | |   | | |     |           | | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |     | |   | |     | | |   | |     | |   | |
 +-+ | |   | | |     |   +-------+ | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |     | |   | |     | | |   | |     | +-+ | |
   | | |   | | |     |   |         | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |     | |   | |     | | |   | |     |   | | |
   | | |   | | |     |   |         | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |     | |   | |     | | |   | |     |   | | |
   | | |   | | |     |   |         | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |     | |   | |     | | |   | |     |   | | |
   | | |   | | |     |   |   +-------|-------|---|---------------|-----------------------|---------------|-----------------------------------------|-+     |     +-|---+ |     | | |   | +-------+ | | |
   | | |   | | |     |   |   |     | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | |       |       |     |     | | |   |       | | | | |
   | | |   | | |     |   |   | +---|-|-----------|-----|-------+ |     |     | |       | |       |       | | |                           |       | |       |       |     |     | | |   |       | | | | |
   | | |   | | |     |   |   | |   | |       |   |     |   | | | |     |     | |       | |       |       | | |                           |       | |       |       |     |     | | |   |       | | | | |
   | | |   | | |     |   |   +-|-------------|---------------|---------|---------------------------------|-|-------------------------------------|-|---------------------------|-|---+ |       | | | | |
   | | |   | | |     |   |     |   | |       |   |     |   | | | |     |     | |       | |       |       | | |                           |       | |       |       |     |     | | | | |       | | | | |
 +-----------|-|-----------------------------|---|---+ |   | | | +-----------|---------------------------|-|-----------------------------|-----------------|-------------|-----|---|-|---+     | | | | |
 | | | |   | | |     |   |     |   | |       |   |   | |   | | |       |     | |       | |       |       | | |                           |       | |       |       |     |     | | | | | |     | | | | |
 | | | |   | | |     |   |   +-----|-------------+   | |   | | |       |     | |       | |       |       | | |                           |       | |       |       |     |     | | | | | |     | | | | |
 | | | |   | | |     |   |   | |   | |       |       | |   | | |       |     | |       | |       |       | | |                           |       | |       |       |     |     | | | | | |     | | | | |
 | | | +---|-+ +-----|---------|---+ |       |       | +-----|-|-------|-------|-----------------|---------------+                       |       | |       |       |     +-----|-|-+ | | | +-+ | | | | |
 | | |     |         |   |   | |     |       |       |     | | |       |     | |       | |       |       | | |   |                       |       | |       |       |           | |   | | | | | | | | | |
 | | | L---|---+     |   |   | |     |     +-----------------|---------------|---------|---------|-------|---|---|-----------------------|-------|---------|-------|---------------------|-+ | | | | | |
 | | |     |   |     |   |   | |     |     | |       |     | | |       |     | |       | |       |       | | |   |                       |       | |       |       |           | |   | | |   | | | | | |
 +-|---+   |   |     |   |   | |     |     | |       |     | | |       |     | |       +-|---------------|---|---|-----------------------|-------|-----------------------------------|-+ |   | | | | | |
   | | |   |   |     |   |   | |     |     | |       |     | | |       |     | |         |       |       | | |   |                       |       | |       |       |           | |   |   |   | | | | | |
   | | |   |   |     +---|-----|-----+     | |       |     | | |       |     | |         |       |       | | |   +-------------------------------|---------|-------|-----------+ +---------+ | | | | | |
   | | |   |   |         |   | |           | |       |     | | |       |     | |         |       |       | | |                           |       | |       |       |                 |   | | | | | | | |
   | | +---|-----------------|-|-----------|-|---+   |     | | |       +-----|-|-----------------|---------|-|---------------------------|---------|-------+       |                 |   | | | | | | | |
   | |     |   |         |   | |           | |   |   |     | | |             | |         |       |       | | |                           |       | |               |                 |   | | | | | | | |
   +-|---------+         |   | +-----------|-----+   |     | | |             | |         |       |       | | |                 +-----------------|-|---------------|-----------------+   +-+ +-|-|-+ | |
     |     |             |   |             | |       |     | | |             | |         |       |       | | |                 |         |       | |               |                           | |   | |
     |     |             |   |             | |       |     | | |             | |         |       |       | | |                 |         |       | |               |                           | |   | |
     |     |             |   |             | |       |     | | |             | |         |       |       | | |                 |         |       | |               |                           | |   | |
     |     |             |   |             | |       |     | | |             +-------------------|-------|Z--+                 |         |       | +---------------------------------------+   | |   | |
     |     |             |   |             | |       |     | | |               |         |       |       | |                   |         |       |                 |                       |   | |   | |
     |     |             |   |             | |       |     | +-----------------|---------|-------+       | |                   |         |       |                 +-------------------------+ | |   | |
     |     |             |   |             | |       |     |   |               |         |               | |                   |         |       |                                         | | | |   | |
     |     |             |   +-------------|---------|-----|---|---------------+ +---------------------------------------------|-----------------|-------------------------------------------|-|-|-----+
     |     |             |                 | |       |     |   |                 |       |               | |                   |         |       |                                         | | | |   |
     +-----|-------------|-----------------|-|-------+     |   |                 |       |               | |                   |         |       |                                         | | | |   |
           |             |                 | |             |   |                 |       |               | |                   |         |       |                                         | | | |   |
           |             +-----------------|---------------|---------------------+       |               | |                   |         |       |                                         | +---|-----+
           |                               | |             |   |                         |               | |                   |         |       |                                         |   | |   | |
           |                   +---------------------------|---|-------------------------|-----------------|-------------------|---------+       |           +-----------------------------+   | |   | |
           |                   |           | |             |   |                         |               | |                   |                 |           |                                 | |   | |
           |                   |           | |             |   |                         |               | +-------+           |                 +-----------|-----------------------------------+   | |
           |                   |           | |             |   |                         |               |         |           |                             |                                 |     | |
           |                   |           | |             |   |                         |               +---------|-----------------------------------------|---------------------------------+   +-+ |
           |                   |           | |             |   |                         |                         |           |                             |                                     |   |
           |                   +-------------|-------------|---|---------------------------------------------------|-----------|-----------------------------|-----------------------------------------+
           |                               | |             |   |                         |                         |           |                             |                                     |
           |                               +-|-----------------+                         +-------------------------|-----------+                             +---------------+                 +---+
           |                                 |             |                                                       |                                                         |                 |
           +---------------------------------+             +-------------------------------------------------------+                                                         +-----------------+


`

val _testInput = `
     |
     |  +--+
     A  |  C
 F---|----E|--+
     |  |  |  D
     +B-+  +--+
`

class GridStuff =

	var grid: String[]
	var y = 0
	var x = 0
	var direction = "down"
	var path = new Vector<Char>()

	Val DIRECTIONS = [ "down", "up", "left", "rig   ht" ]

	Def new(input: String) =
		val lines = input.split("\r?\n")
		var width = 0
		for(var i = 0; i < lines.Size(); i++)
			width = Math.max(width, lines[i].Size())
		var sb = new StringBuilder()
		this.grid = new String[lines.Size() - 1]
		for(var i = 0; i < grid.Size(); i++)
			sb.append(lines[i + 1])
			while(sb.length() < width)
				sb.append(' ')
			grid[i] = sb.toString()
			sb = new StringBuilder()


		x = FindStart(grid)

	Def FindStart(grid: String[]) =
		val firstLine = grid[0]
		for(var i = 0; i < firstLine.Size(); i++)
			if(firstLine[i] != ' ')
				return i
		return -1

	Def Run() =
		var currentChar = grid[y][x]
		while(currentChar != ' ')
			currentChar = grid[y][x]

			if(currentChar == '+')
				direction = GetDirection()
			else if(currentChar >= 'A' && currentChar <= 'Z')
				path.Add(currentChar)


			if(direction == "down")
				y++
			else if(direction == "up")
				y--
			else if(direction == "right")
				x++
			else if(direction == "left")
				x--
		println(path.MakeString("")) // res: SXPZDFJNRL

	Def GetDirection() =
		if(direction == "down" || direction == "up")
			return (x > 0 && grid[y][x - 1] != ' ') ? "left" : "right"
		return (y > 0 && grid[y - 1][x] != ' ') ? "up" : "down"


new GridStuff(input).Run()

